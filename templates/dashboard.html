{% extends "base.html" %}
{% block content %}
<h4 class="mb-3">Engagement Analytics</h4>

<div class="row g-4">
  <div class="col-12 col-lg-3">
    <div class="card p-3">
      <div class="small text-secondary">Avg Session Duration</div>
      <div class="fs-4 fw-bold">{{ kpis.avg_duration|default(0)|round(2) }}s</div>
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <div class="card p-3">
      <div class="small text-secondary">Avg Scroll Depth</div>
      <div class="fs-4 fw-bold">{{ (kpis.avg_scroll * 100)|default(0)|round(1) }}%</div>
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <div class="card p-3">
      <div class="small text-secondary">Total Clicks</div>
      <div class="fs-4 fw-bold">{{ kpis.total_clicks }}</div>
    </div>
  </div>
  <div class="col-12 col-lg-3">
    <div class="card p-3">
      <div class="small text-secondary">Sessions</div>
      <div class="fs-4 fw-bold">{{ kpis.sessions }}</div>
    </div>
  </div>
</div>

<hr>

<div class="row g-4">
  <div class="col-12 col-lg-6">
    <div class="card p-3">
      <h5>Mood vs Avg Duration</h5>
      <div id="chart_mood_duration"></div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card p-3">
      <h5>Most Clicked Elements (by area)</h5>
      <div id="chart_clicks_density"></div>
    </div>
  </div>
</div>

<hr>

<div class="card p-3">
  <h5>Mood → Engagement Insights</h5>
  <ul>
    <li>“When you’re <b>bored</b>, you tend to spend longer on long-reads.”</li>
    <li>“When you’re <b>happy</b>, you click more on videos and memes.”</li>
    <li>“When you’re <b>stressed</b>, you interact more with calm/mindfulness areas.”</li>
    <li>“When you’re <b>curious</b>, you scroll deeper into deep-dives and learning sections.”</li>
  </ul>
  <p class="small text-secondary">These are generic—your actual metrics below will reflect your own sessions.</p>
</div>

<script>
  // Plotly charts (data embedded by Jinja)
  const moodDur = {{ charts.mood_duration | safe }};
  Plotly.newPlot("chart_mood_duration", moodDur.data, moodDur.layout, {displayModeBar:false});

  const clickDensity = {{ charts.click_density | safe }};
  Plotly.newPlot("chart_clicks_density", clickDensity.data, clickDensity.layout, {displayModeBar:false});
</script>

{% endblock %}
